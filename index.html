<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OpoVerbal - Entrena tu mente</title>
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- REACT & REACT DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- BABEL -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- ESTILOS PERSONALIZADOS Y FUENTES -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overscroll-behavior: none; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.5s ease-out forwards; }
        
        .float-slow { animation: float 4s ease-in-out infinite; }
        .float-medium { animation: float 3s ease-in-out 1s infinite; }
        .float-fast { animation: float 3.5s ease-in-out 0.5s infinite; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 
            0% { transform: translateY(0px); } 
            50% { transform: translateY(-5px); } 
            100% { transform: translateY(0px); } 
        }
        
        .bg-verbalopo {
            background: linear-gradient(180deg, #F3F4F6 0%, #FFFFFF 100%);
        }
        
        /* Ocultar scrollbar */
        ::-webkit-scrollbar { display: none; }

        /* Estilo discreto para el input n√∫mero */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button {  
           opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen w-screen overflow-hidden selection:bg-blue-100">

    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* ==========================================================================
           ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è SECCI√ìN 1: BASE DE DATOS - ORTOGRAF√çA ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
           ==========================================================================
        */
        const spellingDatabase = [
            {
                id: "hecho_echo",
                title: "HECHO / ECHO",
                content: "HECHO: Del verbo hacer (participio). Significa realizar algo o un suceso.\nEj: 'He hecho los deberes'. 'Es un hecho probado'.\n\nECHO: Del verbo echar. Significa tirar, lanzar o expulsar.\nEj: 'Echo la carta al buz√≥n'. 'Te echo de menos'."
            },
            {
                id: "haber_aver",
                title: "HABER / A VER",
                content: "HABER: Verbo auxiliar o sustantivo (existencia).\nEj: 'Tiene que haber algo'. 'Su haber es grande'.\n\nA VER: Preposici√≥n 'a' + verbo 'ver'. Indica inter√©s, expectaci√≥n o comprobaci√≥n.\nEj: 'Voy a ver a mi abuela'. '¬°A ver si apruebas!'."
            },
            {
                id: "hasta_asta",
                title: "HASTA / ASTA",
                content: "HASTA: Preposici√≥n que indica l√≠mite o final.\nEj: 'Estar√© hasta las ocho'.\n\nASTA: Cuerno de animal o palo de la bandera.\nEj: 'El toro ten√≠a un asta rota'. 'Bandera a media asta'."
            },
            {
                id: "ha_a",
                title: "HA / A",
                content: "HA: Del verbo haber (auxiliar). Se usa delante de participios (acabados en -ado, -ido).\nEj: 'Ha comido'. 'Ha venido'.\n\nA: Preposici√≥n. Se usa en el resto de casos.\nEj: 'Voy a casa'. 'Vamos a jugar'."
            },
            {
                id: "tu_tu",
                title: "TU / T√ö",
                content: "T√ö: Pronombre personal. Lleva tilde cuando sustituye a la persona.\nEj: 'T√∫ eres el mejor'.\n\nTU: Adjetivo posesivo. No lleva tilde.\nEj: 'Tu coche es r√°pido'."
            },
            {
                id: "hay_ahi_ay",
                title: "HAY / AH√ç / ¬°AY!",
                content: "HAY: Del verbo haber (existencia).\nEj: 'Hay manzanas'.\n\nAH√ç: Adverbio de lugar.\nEj: 'D√©jalo ah√≠'.\n\n¬°AY!: Interjecci√≥n de dolor o sorpresa.\nEj: '¬°Ay! Me he hecho da√±o'."
            },
            {
                id: "el_el",
                title: "EL / √âL",
                content: "√âL: Pronombre personal. Se refiere a una persona.\nEj: 'D√≠selo a √©l'.\n\nEL: Art√≠culo determinado.\nEj: 'El libro est√° aqu√≠'."
            },
            {
                id: "mas_mas",
                title: "MAS / M√ÅS",
                content: "M√ÅS: Adverbio de cantidad. Lleva tilde.\nEj: 'Quiero m√°s caf√©'.\n\nMAS: Conjunci√≥n adversativa (equivalente a 'pero'). No lleva tilde.\nEj: 'Quiso ir, mas no pudo'."
            },
            {
                id: "mi_mi",
                title: "M√ç / MI",
                content: "M√ç: Pronombre personal. Lleva tilde.\nEj: 'Es para m√≠'.\n\nMI: Adjetivo posesivo o nota musical.\nEj: 'Mi casa'. 'Nota mi'."
            },
            {
                id: "vaya_valla",
                title: "VAYA / VALLA",
                content: "VAYA: Del verbo ir o interjecci√≥n.\nEj: 'Espero que vaya bien'. '¬°Vaya coche!'\n\nVALLA: Cerca, vallado o obst√°culo.\nEj: 'Salt√≥ la valla'."
            },
            {
                id: "cayo_callo",
                title: "CAY√ì / CALL√ì",
                content: "CAY√ì: Del verbo caer.\nEj: 'Se cay√≥ al suelo'.\n\nCALL√ì: Del verbo callar.\nEj: 'Se call√≥ porque no sab√≠a la respuesta'."
            },
            {
                id: "sino_sino",
                title: "SINO / SI NO",
                content: "SINO: Conjunci√≥n adversativa o sustantivo (destino).\nEj: 'No es blanco, sino negro'.\n\nSI NO: Condicional + negaci√≥n.\nEj: 'Si no vienes, me voy'."
            },
            {
                id: "tambien_tanbien",
                title: "TAMBI√âN / TAN BIEN",
                content: "TAMBI√âN: Adverbio de afirmaci√≥n o igualdad.\nEj: 'Yo tambi√©n voy'.\n\nTAN BIEN: Cuantificador + adverbio (comparaci√≥n).\nEj: 'Lo hizo tan bien como t√∫'."
            },
            {
                id: "tampoco_tanpoco",
                title: "TAMPOCO / TAN POCO",
                content: "TAMPOCO: Adverbio de negaci√≥n.\nEj: 'No quiero eso tampoco'.\n\nTAN POCO: Cuantificador + adjetivo/adverbio (cantidad).\nEj: 'Comi√≥ tan poco que se desmay√≥'."
            }
        ];

        /* ==========================================================================
           ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è SECCI√ìN 2: BASE DE DATOS - PREGUNTAS TEST ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
           ==========================================================================
        */
        const questionsDatabase = [
            {
                id: 1,
                question: "Se√±ale qu√© palabra corresponde a la siguiente definici√≥n: \"Manantial que brota de la tierra.\"",
                options: [
                    { id: 'a', text: "Fontana" },
                    { id: 'b', text: "Riachuelo" },
                    { id: 'c', text: "Caudal" },
                    { id: 'd', text: "Pechina" }
                ],
                correctAnswer: 'a',
                explanation: "La respuesta correcta es la a) Fontana. Como experto en el l√©xico espa√±ol, te confirmo que el Diccionario de la Real Academia Espa√±ola (DLE) define fontana simplemente como \"Perteneciente a la fuente\", y a su vez, la primera acepci√≥n de \"fuente\" es textualmente \"manantial de agua que brota de la tierra\"."
            },
            {
                id: 2,
                question: "Se√±ale qu√© definici√≥n es la que se corresponde con la palabra ENERVAR.",
                options: [
                    { id: 'a', text: "Menoscabar, disminuir algo no material. MELLAR" },
                    { id: 'b', text: "Poner nervioso." },
                    { id: 'c', text: "Estar subordinado a alguien o algo." },
                    { id: 'd', text: "Echar a perder cualquier asunto. ESTROPEAR" }
                ],
                correctAnswer: 'b',
                explanation: "Enervar: Poner nervioso, excitar, airar. En el contexto de oposiciones, suele buscarse esta acepci√≥n frente a 'debilitar'."
            },
            {
                id: 3,
                question: "Se√±ale cu√°l es el sin√≥nimo de la palabra ACERBO.",
                options: [
                    { id: 'a', text: "Alegre" },
                    { id: 'b', text: "Fam√©lico" },
                    { id: 'c', text: "Fat√≠dico" },
                    { id: 'd', text: "Desapacible" }
                ],
                correctAnswer: 'd',
                explanation: "Acerbo significa √°spero al gusto o cruel/riguroso de genio. Desapacible es su sin√≥nimo m√°s cercano."
            },
            {
                id: 4,
                question: "Se√±ale el ant√≥nimo de: EF√çMERO",
                options: [
                    { id: 'a', text: "Fugaz" },
                    { id: 'b', text: "Duradero" },
                    { id: 'c', text: "Pasajero" },
                    { id: 'd', text: "Breve" }
                ],
                correctAnswer: 'b',
                explanation: "Ef√≠mero es algo de corta duraci√≥n. Duradero es lo opuesto."
            }
        ];

        /* ==========================================================================
           ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è SECCI√ìN 3: C√ìDIGO DE LA APLICACI√ìN (L√ìGICA Y DISE√ëO) ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
           ==========================================================================
        */

        // --- UTILS ---
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // --- ILUSTRACI√ìN ---
        const CustomPhoneIllustration = () => (
            <div className="relative w-56 h-56 mx-auto mt-2 mb-4">
                <svg viewBox="0 0 300 300" className="w-full h-full drop-shadow-lg">
                    <rect x="65" y="20" width="170" height="260" rx="25" fill="none" stroke="#1E293B" strokeWidth="7" />
                    <path d="M110 20 L110 32 Q110 40 120 40 L180 40 Q190 40 190 32 L190 20" fill="#1E293B" />
                    <g className="float-fast">
                        <rect x="170" y="35" width="90" height="36" rx="18" fill="#60A5FA" />
                        <path d="M200 70 L205 80 L215 70 Z" fill="#60A5FA" />
                        <text x="215" y="58" textAnchor="middle" fill="white" fontSize="16" fontWeight="bold" fontFamily="sans-serif">Alifafe</text>
                    </g>
                    <g className="float-slow">
                        <rect x="15" y="60" width="110" height="46" rx="23" fill="#FB923C" />
                        <path d="M85 100 L90 110 L100 100 Z" fill="#FB923C" />
                        <text x="70" y="92" textAnchor="middle" fill="white" fontSize="24" fontWeight="bold" fontFamily="sans-serif">√°cido</text>
                    </g>
                    <g className="float-medium">
                        <rect x="135" y="90" width="130" height="42" rx="21" fill="#2563EB" />
                        <text x="200" y="118" textAnchor="middle" fill="white" fontSize="20" fontWeight="bold" fontFamily="sans-serif">escueto</text>
                    </g>
                    <g className="float-fast">
                        <rect x="65" y="145" width="130" height="42" rx="21" fill="#1E293B" />
                        <text x="130" y="173" textAnchor="middle" fill="white" fontSize="20" fontWeight="bold" fontFamily="sans-serif">somero</text>
                    </g>
                    <g className="float-slow">
                        <rect x="105" y="210" width="80" height="40" rx="20" fill="#FB923C" />
                        <path d="M135 220 L155 240 M155 220 L135 240" stroke="white" strokeWidth="3" strokeLinecap="round" />
                    </g>
                    <g className="float-medium">
                        <circle cx="215" cy="180" r="18" fill="#10B981" stroke="white" strokeWidth="2" />
                        <path d="M207 180 L212 185 L224 173" fill="none" stroke="white" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                    </g>
                </svg>
            </div>
        );

        // --- ICONOS SVG ---
        const IconTimer = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></svg>;
        const IconCheck = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const IconX = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconHome = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>;
        const IconChevronRight = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>;
        const IconBook = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const IconArrowLeft = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>;
        const IconRefresh = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>;
        const IconPlay = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>;

        function App() {
            const [screen, setScreen] = useState('welcome');
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswered, setIsAnswered] = useState(false);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(30);
            
            const [isRandomMode, setIsRandomMode] = useState(false);
            const [activeQuestions, setActiveQuestions] = useState([]);
            const [selectedSpellingTopic, setSelectedSpellingTopic] = useState(null);
            
            // Cantidad de preguntas (por defecto 10)
            const [questionCount, setQuestionCount] = useState(10);
            
            // NUEVO: Historial de preguntas usadas para evitar repeticiones en la misma sesi√≥n
            const [usedQuestionIds, setUsedQuestionIds] = useState([]);

            useEffect(() => {
                if (screen !== 'quiz' || isAnswered) return;
                const timer = setInterval(() => {
                    setTimeLeft((prev) => {
                        if (prev <= 1) {
                            setIsAnswered(true);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, [currentQuestionIndex, screen, isAnswered]);

            const startQuiz = () => {
                // 1. Calculamos cu√°ntas preguntas necesitamos como m√°ximo (limitado por el total de la BD)
                const totalAvailableInDB = questionsDatabase.length;
                const questionsNeeded = Math.min(questionCount, totalAvailableInDB);

                // 2. Filtramos las preguntas que NO han salido todav√≠a (IDs no est√°n en usedQuestionIds)
                let availableQuestions = questionsDatabase.filter(q => !usedQuestionIds.includes(q.id));

                // 3. Si no hay suficientes preguntas nuevas para llenar el cupo...
                if (availableQuestions.length < questionsNeeded) {
                    // Reiniciamos el historial (vuelta a empezar) porque ya se han visto casi todas
                    // y cogemos de toda la base de datos de nuevo.
                    availableQuestions = [...questionsDatabase];
                    setUsedQuestionIds([]); // Reset del historial
                }

                // 4. Barajamos las disponibles
                let shuffled = shuffleArray(availableQuestions);

                // 5. Cogemos las que necesitamos
                const selectedQuestions = shuffled.slice(0, questionsNeeded);

                // 6. Actualizamos el historial con las nuevas que vamos a usar
                if (availableQuestions.length === totalAvailableInDB && usedQuestionIds.length > 0 && availableQuestions.length < questionsDatabase.length + questionsNeeded) {
                     setUsedQuestionIds(selectedQuestions.map(q => q.id));
                } else {
                     if (availableQuestions.length === totalAvailableInDB) {
                         setUsedQuestionIds(selectedQuestions.map(q => q.id));
                     } else {
                         setUsedQuestionIds(prev => [...prev, ...selectedQuestions.map(q => q.id)]);
                     }
                }

                setActiveQuestions(selectedQuestions);
                setScreen('quiz');
                setCurrentQuestionIndex(0);
                setScore(0);
                setIsAnswered(false);
                setSelectedOption(null);
                setTimeLeft(30);
            };

            // Repetir el MISMO test (sin re-barajar ni cambiar preguntas)
            const restartSameQuiz = () => {
                setCurrentQuestionIndex(0);
                setScore(0);
                setIsAnswered(false);
                setSelectedOption(null);
                setTimeLeft(30);
                setScreen('quiz');
            };

            const goHome = () => {
                setScreen('welcome');
            };

            const goToSpellingMenu = () => {
                setScreen('spelling_menu');
            };

            const openSpellingTopic = (topic) => {
                setSelectedSpellingTopic(topic);
                setScreen('spelling_detail');
            };

            const handleOptionSelect = (optionId) => {
                if (isAnswered) return;
                setSelectedOption(optionId);
                setIsAnswered(true);
                if (optionId === activeQuestions[currentQuestionIndex].correctAnswer) {
                    setScore(score + 1);
                }
            };

            const nextQuestion = () => {
                if (currentQuestionIndex < activeQuestions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption(null);
                    setIsAnswered(false);
                    setTimeLeft(30);
                } else {
                    setScreen('results');
                }
            };

            // --- PANTALLA 1: PORTADA ---
            if (screen === 'welcome') {
                return (
                    <div className="h-full w-full bg-verbalopo flex flex-col items-center justify-start pt-2 p-4 relative overflow-hidden">
                        
                        <div className="w-full max-w-sm text-center z-10 slide-up flex flex-col items-center justify-start gap-2 mt-4">
                            
                            {/* BOTONES SUPERIORES */}
                            <div className="flex gap-2 mb-2 w-full justify-center">
                                {/* Bot√≥n Ortograf√≠a */}
                                <button 
                                    onClick={goToSpellingMenu}
                                    className="py-2 px-4 rounded-full shadow-sm border border-slate-200 bg-white text-slate-600 flex items-center gap-1 transition-all active:scale-95"
                                >
                                    <IconBook />
                                    <span className="text-xs font-bold uppercase tracking-wider">Ortograf√≠a</span>
                                </button>

                                {/* Selector de Preguntas (Arriba a la derecha) */}
                                <div className="flex items-center bg-white rounded-full px-3 py-1 shadow-sm border border-slate-200 gap-1">
                                    <span className="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Preguntas:</span>
                                    <input 
                                        type="number" 
                                        min="1" 
                                        max={questionsDatabase.length}
                                        value={questionCount}
                                        onChange={(e) => setQuestionCount(parseInt(e.target.value) || 1)}
                                        className="w-10 text-center font-bold text-sm text-blue-600 outline-none bg-transparent border-b border-slate-200 focus:border-blue-500 transition-colors"
                                    />
                                </div>
                            </div>

                            <h1 className="text-5xl font-extrabold text-slate-800 mb-1 tracking-tight">OpoVerbal</h1>
                            
                            <div className="px-4 leading-tight">
                                <p className="text-lg text-slate-600 font-semibold">
                                    La diferencia entre dudar y acertar est√° en tu entrenamiento. Potencia tu verbal.
                                </p>
                            </div>

                            <CustomPhoneIllustration />

                            <div className="mt-4">
                                <button 
                                    onClick={startQuiz}
                                    className="bg-blue-600 hover:bg-blue-700 text-white text-lg font-bold py-2 px-8 rounded-full shadow-xl shadow-blue-200/50 transform transition active:scale-95"
                                >
                                    Empezar a practicar
                                </button>
                            </div>

                            <div className="mt-6 text-[10px] text-slate-400 font-medium tracking-widest">
                                (c) manu sansano v1.1
                            </div>
                        </div>
                    </div>
                );
            }

            // --- PANTALLA: MEN√ö ORTOGRAF√çA ---
            if (screen === 'spelling_menu') {
                return (
                    <div className="h-full w-full bg-slate-50 flex flex-col font-sans fade-in">
                        <div className="bg-white shadow-sm px-4 py-4 flex items-center gap-3 z-10">
                            <button onClick={goHome} className="p-2 -ml-2 rounded-full hover:bg-slate-100 text-slate-600">
                                <IconArrowLeft />
                            </button>
                            <h2 className="text-xl font-black text-slate-800 tracking-tight">ORTOGRAF√çA</h2>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-4">
                            <div className="grid grid-cols-2 gap-3 pb-4">
                                {spellingDatabase.map((topic) => (
                                    <button 
                                        key={topic.id}
                                        onClick={() => openSpellingTopic(topic)}
                                        className="bg-white p-3 rounded-xl shadow-sm border border-slate-200 hover:border-blue-400 hover:shadow-md transition-all text-center active:scale-[0.98] flex items-center justify-center min-h-[70px]"
                                    >
                                        <span className="text-sm font-bold text-slate-700 uppercase leading-tight">{topic.title}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // --- PANTALLA: DETALLE ORTOGRAF√çA ---
            if (screen === 'spelling_detail' && selectedSpellingTopic) {
                return (
                    <div className="h-full w-full bg-slate-50 flex flex-col font-sans slide-up">
                        <div className="bg-white shadow-sm px-4 py-4 flex items-center gap-3 z-10">
                            <button onClick={() => setScreen('spelling_menu')} className="p-2 -ml-2 rounded-full hover:bg-slate-100 text-slate-600">
                                <IconArrowLeft />
                            </button>
                            <h2 className="text-lg font-black text-slate-800 tracking-tight truncate">{selectedSpellingTopic.title}</h2>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-6">
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                                <div className="prose prose-slate text-base leading-relaxed whitespace-pre-line text-slate-700">
                                    {selectedSpellingTopic.content}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- PANTALLA 2: RESULTADOS ---
            if (screen === 'results') {
                return (
                    <div className="h-full w-full bg-verbalopo flex flex-col items-center justify-center p-6 fade-in">
                        <div className="bg-white rounded-3xl shadow-lg p-8 w-full max-w-sm text-center border border-slate-100">
                            <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span className="text-3xl">üèÜ</span>
                            </div>
                            <h2 className="text-2xl font-bold text-slate-800 mb-1">¬°Test Finalizado!</h2>
                            <p className="text-sm text-slate-500 mb-6">Aqu√≠ tienes tu puntuaci√≥n final</p>
                            
                            <div className="flex items-baseline justify-center gap-1 mb-8">
                                <span className="text-6xl font-black text-blue-600 tracking-tighter">{score}</span>
                                <span className="text-xl text-slate-400 font-medium">/ {activeQuestions.length}</span>
                            </div>
                            
                            <div className="space-y-3 w-full">
                                <button onClick={startQuiz} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2">
                                    <IconPlay /> Nuevo Test
                                </button>
                                
                                <button onClick={restartSameQuiz} className="w-full bg-slate-800 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2">
                                    <IconRefresh /> Repetir Test
                                </button>
                                
                                <button onClick={goHome} className="w-full bg-white text-slate-500 border-2 border-slate-100 py-3 rounded-xl font-bold hover:bg-slate-50 active:scale-95 transition-transform flex items-center justify-center gap-2">
                                    <IconHome /> Volver al Inicio
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- PANTALLA 3: QUIZ ---
            const currentQuestion = activeQuestions[currentQuestionIndex];
            return (
                <div className="h-full w-full bg-slate-50 flex flex-col items-center font-sans fade-in">
                    <div className="w-full max-w-md bg-white shadow-sm z-10 px-4 py-3 flex items-center justify-between shrink-0">
                        <button onClick={goHome} className="p-2 -ml-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors">
                            <IconHome />
                        </button>
                        <span className="text-xl font-black text-slate-700 tracking-wide">OpoVerbal</span>
                        <div className={`flex items-center gap-1 px-2.5 py-1 rounded-full font-mono font-bold text-sm ${timeLeft < 10 ? 'bg-red-50 text-red-500' : 'bg-slate-100 text-slate-600'}`}>
                            <IconTimer /> {timeLeft}s
                        </div>
                    </div>

                    <div className="w-full max-w-md flex-1 overflow-y-auto p-4 flex flex-col">
                        <div className="mb-3">
                            <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 text-[10px] font-extrabold rounded-full tracking-wider">
                                PREGUNTA {currentQuestionIndex + 1} DE {activeQuestions.length}
                            </span>
                        </div>
                        <h3 className="text-lg font-bold text-slate-800 leading-snug mb-5">
                            {currentQuestion.question}
                        </h3>
                        <div className="space-y-2.5 mb-2">
                            {currentQuestion.options.map((option) => {
                                const isSelected = selectedOption === option.id;
                                const isCorrect = option.id === currentQuestion.correctAnswer;
                                let containerClass = "border border-slate-200 bg-white shadow-sm hover:border-blue-300";
                                let textClass = "text-slate-600 font-medium";
                                let circleClass = "bg-slate-100 text-slate-400 font-bold";
                                let circleContent = option.id.toUpperCase();

                                if (isAnswered) {
                                    if (isCorrect) {
                                        containerClass = "border-green-200 bg-green-50 ring-1 ring-green-200";
                                        textClass = "text-green-800 font-semibold";
                                        circleClass = "bg-green-500 text-white";
                                        circleContent = <IconCheck />;
                                    } else if (isSelected && !isCorrect) {
                                        containerClass = "border-red-200 bg-red-50 ring-1 ring-red-200";
                                        textClass = "text-red-800";
                                        circleClass = "bg-red-500 text-white";
                                        circleContent = <IconX />;
                                    } else {
                                        containerClass = "border-slate-100 opacity-50 bg-slate-50";
                                    }
                                } else if (isSelected) {
                                    containerClass = "border-blue-500 bg-blue-50 ring-1 ring-blue-500";
                                    textClass = "text-blue-900 font-semibold";
                                    circleClass = "bg-blue-500 text-white";
                                }

                                return (
                                    <button
                                        key={option.id}
                                        onClick={() => handleOptionSelect(option.id)}
                                        disabled={isAnswered}
                                        className={`w-full text-left py-2.5 px-3 rounded-xl transition-all duration-200 flex items-center gap-3 active:scale-[0.99] ${containerClass}`}
                                    >
                                        <div className={`w-7 h-7 rounded-full flex items-center justify-center text-xs shrink-0 transition-colors ${circleClass}`}>
                                            {circleContent}
                                        </div>
                                        <span className={`text-base leading-tight ${textClass}`}>{option.text}</span>
                                    </button>
                                );
                            })}
                        </div>
                        {isAnswered && (
                            <div className="mt-1 pt-2 slide-up">
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-3">
                                    <div className="flex gap-2.5">
                                        <div className="mt-0.5 text-blue-500 shrink-0"><IconCheck /></div>
                                        <div>
                                            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Explicaci√≥n</p>
                                            <p className="text-sm text-slate-600 leading-relaxed">{currentQuestion.explanation}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-center">
                                    <button 
                                        onClick={nextQuestion}
                                        className="bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-blue-200 active:bg-blue-700 active:scale-[0.98] transition-all flex items-center gap-2"
                                    >
                                        {currentQuestionIndex < activeQuestions.length - 1 ? 'Siguiente Pregunta' : 'Ver Resultados'}
                                        <IconChevronRight />
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
